{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Imputation Server 2","text":"<p>This repository includes the Imputation Server 2 Nextflow workflow.</p>"},{"location":"#run-with-test-data","title":"Run with test data","text":"<p>The pipeline provides small test data to verify installation:</p> <pre><code>nextflow run main.nf -c conf/test_single_vcf.config\n</code></pre>"},{"location":"#run-with-custom-configuration","title":"Run with custom configuration","text":"<p><code>job.config</code>:</p> <pre><code>params {\n    project                 = \"my-test-project\"\n    build                   = \"hg19\"\n    files                   = \"tests/input/three/*.vcf.gz\"\n    allele_frequency_population              = \"eur\"\n    mode                    = \"imputation\"\n    refpanel_yaml           = \"tests/hapmap-2/2.0.0/imputation-hapmap2.yaml\"\n    output                  = \"output\"\n}\n</code></pre> <p>Run pipeline with <code>job.config</code> configuration:</p> <pre><code>nextflow run main.nf -c job.config\n</code></pre>"},{"location":"#parameters","title":"Parameters","text":"Parameter Default Value Description <code>project</code> <code>null</code> Project name <code>project_date</code> <code>date</code> Project date <code>files</code> <code>null</code> List of input files <code>allele_frequency_population</code> <code>null</code> Allele Frequency Population information <code>refpanel_yaml</code> <code>null</code> Reference panel YAML file <code>mode</code> <code>imputation</code> Processing mode (e.g., 'imputation' or `qc-only``) <code>chunksize</code> <code>20000000</code> Chunk size for processing <code>min_samples</code> <code>20</code> Minimum number of samples needed <code>max_samples</code> <code>50000</code> Maximum number of samples allowed <code>merge_samples</code> <code>true</code> Execute compression and encryption workflow <code>password</code> <code>null</code> Password for encryption <code>send_mail</code> <code>false</code> Enable or disable email notifications <code>service.name</code> <code>Imputation Server 2</code> Service name <code>service.email</code> <code>null</code> Service email <code>service.url</code> <code>null</code> Service URL <code>user.name</code> <code>null</code> User's name <code>user.email</code> <code>null</code> User's email <code>phasing.engine</code> <code>eagle</code> Phasing method (e.g., 'eagle' or <code>beagle</code>) <code>phasing.window</code> <code>5000000</code> Phasing window size <code>imputation.enabled</code> <code>true</code> Enable or disable imputation <code>imputation.window</code> <code>500000</code> Imputation window size <code>imputation.minimac_min_ratio</code> <code>0.00001</code> Minimac minimum ratio <code>imputation.min_r2</code> <code>0</code> R2 filter value <code>imputation.meta</code> <code>false</code> Enable or disable empirical output creation <code>imputation.md5</code> <code>false</code> Enable or disable md5 sum creation for results <code>imputation.create_index</code> <code>false</code> Enable or disable index creation for imputed files <code>imputation.decay</code> <code>0</code> Set minimac decay <code>encryption.enabled</code> <code>true</code> Enable or disable encryption <code>encryption.aes</code> <code>false</code> Enable or disable AES method for encryption <code>ancestry.enabled</code> <code>false</code> Enable or disable ancestry analysis <code>ancestry.dim</code> <code>10</code> Ancestry analysis dimension <code>ancestry.dim_high</code> <code>20</code> High dimension for ancestry analysis <code>ancestry.batch_size</code> <code>50</code> Batch size for ancestry analysis <code>ancestry.reference</code> <code>null</code> Ancestry reference data <code>ancestry.max_pcs</code> <code>8</code> Maximum principal components for ancestry <code>ancestry.k</code> <code>10</code> K value for ancestry analysis <code>ancestry.threshold</code> <code>0.75</code> Ancestry threshold"},{"location":"#reference-panel-configuration","title":"Reference Panel Configuration","text":"<p>This document describes the structure of a YAML file used to configure a reference panel for Imputation Servers. Reference panels are essential for genotype imputation, allowing the server to infer missing genotype data accurately.</p>"},{"location":"#yaml-structure","title":"YAML Structure","text":"Field Description <code>name</code> The name of the reference panel. <code>description</code> A brief description of the reference panel. <code>version</code> The version of the reference panel. <code>website</code> The website where more information about the panel can be found. <code>category</code> The category to which the reference panel belongs. TODO: has to be RefPanel <code>properties</code> A section containing specific properties of the reference panel."},{"location":"#properties","title":"Properties","text":"<p>The <code>properties</code> section contains the following key-value pairs:</p> Property Description Required <code>id</code> An identifier for the reference panel. yes <code>genotypes</code> The location of the genotype files for the reference panel data. yes <code>sites</code> The location of the site files for the reference panel data. yes <code>mapEagle</code> The location of the genetic map file used for phasing with eagle. yes <code>refEagle</code> The location of the BCF file for the reference panel data for eagle. yes <code>mapBeagle</code> The location of the genetic map file used for phasing with Beagle. no <code>refBeagle</code> The location of the BCF file for the reference panel data for Beagle. no <code>build</code> The genome build version used for the reference panel (e.g., hg19 or hg38). yes <code>range</code> Specify a range that is used for imputation (e.g. HLA) no <code>mapMinimac</code> The location of the map file for Minimac no <code>populations</code> A dictionary mapping population identifiers to their names. yes <code>qcFilter</code> A dictionary mapping quality filters to their values. no"},{"location":"#populations","title":"Populations","text":"<p>The <code>populations</code> section contains a dictionary mapping population identifiers to their names and sample size. This mapping helps categorize and label the populations represented in the reference panel.</p> Identifier Name <code>id</code> The id of the popualtion (e.g. eur) <code>name</code> The label of the population. (e.g. EUR) <code>samples</code> Number of samples in the reference panel <p>Note: the population id has to be the same as in the legend files.</p>"},{"location":"#quality-filters","title":"Quality Filters","text":"Filter Name Default <code>overlap</code> Minimal overlap between gwas data and reference panel 0.5 <code>minSnps</code> Minimal #SNPs per chunk 3 <code>sampleCallrate</code> Minimal sample call rate 0.5 <code>mixedGenotypeschrX</code> - 0.1 <code>strandFlips</code> Maximal allowed strand flips 100"},{"location":"#example-yaml","title":"Example YAML","text":"<p>Here's an example YAML configuration for a reference panel. This configuration describes a reference panel named \"HapMap 2\" for an Imputation Server, including details about its version, data sources, and populations represented. The files are stored on AWS S3 and are directly consumed by the pipeline from there.</p> <pre><code>name: HapMap 2\ndescription: HapMap2 Reference Panel for Imputation Server\nversion: 2.0.0\nwebsite: http://imputationserver.sph.umich.edu\ncategory: RefPanel\n\nproperties:\n  id: hapmap2\n  genotypes: s3://cloudgene/refpanels/hapmap/m3vcfs/hapmap_r22.chr$chr.CEU.hg19.recode.m3vcf.gz\n  legend: s3://cloudgene/refpanels/hapmap/legends/hapmap_r22.chr$chr.CEU.hg19_impute.legend.gz\n  mapEagle: s3://cloudgene/refpanels/hapmap/map/genetic_map_hg19_withX.txt.gz\n  refEagle: s3://cloudgene/refpanels/hapmap/bcfs/hapmap_r22.chr$chr.CEU.hg19.recode.bcf\n  build: hg19\n  populations:\n    - id: eur\n      name: EUR\n      samples: 60\n    - id: off\n      name: Off\n      samples: -1\n</code></pre>"},{"location":"#note-on-chr-variable","title":"Note on <code>$chr</code> Variable","text":"<p>In the example YAML configuration provided, you may have noticed the presence of the <code>$chr</code> variable in some URLs. This variable is a placeholder for the chromosome number and will be replaced by the Nextflow pipeline.</p>"},{"location":"#legend-files","title":"Legend Files","text":"<p>A legend file is a tab-delimited file consisting of 5 columns (<code>id</code>, <code>position</code>, <code>a0</code>, <code>a1</code>, <code>all.aaf</code>).</p>"},{"location":"#run-with-cloudgene","title":"Run with Cloudgene","text":""},{"location":"#requirements","title":"Requirements:","text":"<ul> <li>Install Nextflow</li> <li>Docker or Singularity</li> <li>Java 14</li> </ul>"},{"location":"#installation","title":"Installation","text":"<ul> <li>Install cloudgene3: <code>curl -s install.cloudgene.io | bash -s 3.0.0-rc3</code></li> <li>Download latest source code zip file from releases</li> <li>Install impuationserver2 app: <code>./cloudgene install imputationserver2@latest</code></li> <li>Install hapmap2 referenece panel: <code>./cloudgene install https://genepi.i-med.ac.at/downloads/imputation/imputation-hapmap2.zip</code></li> <li>Start cloudgene server: <code>./cloudgene server</code></li> <li>Open http://localhost:8082</li> <li>Login with default admin account: username <code>admin</code> and password <code>admin1978</code></li> <li>Imputation can be tested with the following test file</li> </ul>"},{"location":"#default-configuration","title":"Default Configuration","text":"<p>The default configuration runs with Docker and uses Nextflow's local executor.</p>"},{"location":"#running-on-slurm","title":"Running on SLURM","text":"<p>Configure via web interface (Applications -&gt; imputationserver -&gt; Settings) or adapt/create file <code>apps/imputationserver/nextflow.config</code> and add the following:</p> <pre><code>process {\n  executor = 'slurm'\n  queue = 'QueueName'  // replace with your Queue name\n}\n\nerrorStrategy = {task.exitStatus == 143 ? 'retry' : 'terminate'}\nmaxErrors = '-1'\nmaxRetries = 3\n</code></pre> <p>See more about SLURM Nextflow Documentation.</p>"},{"location":"#running-on-aws-batch","title":"Running on AWS Batch","text":"<ol> <li>Create AWS Batch queue and AMI role (see Nextflow Documentation)</li> <li>Configure via web interface (Applications -&gt; imputationserver -&gt; Settings) or adapt/create file <code>apps/imputationserver/nextflow.config</code> and add the following:</li> </ol> <pre><code>aws {\n  region = 'eu-central-1'\n  client {\n    uploadChunkSize = 10485760\n  }\n  batch {\n    cliPath = '/home/ec2-user/miniconda/bin/aws'\n    executionRole = 'arn:aws:iam::***' // replace with your AMI role\n  }\n}\n\nprocess {\n  executor = 'awsbatch'\n  queue = 'QueueName'  // replace with your Queue name\n  scratch = false\n}\n</code></pre> <ol> <li>Got to Settings -&gt; General and set Workspace to \"S3\" and enter the location of a subfolder in an S3 bucket. Enter the location of a subfolder in an S3 bucket. Currently, it must be a subfolder; a bucket won't work (Example: <code>s3://cloudgene/workspace</code>).</li> </ol> <p>Optional add Wave and Fusion support to improve performance:</p> <pre><code>wave {\n  enabled = true\n  endpoint = 'https://wave.seqera.io'\n}\n\nfusion {\n  enabled = true\n}\n</code></pre>"},{"location":"#activate-mail-support","title":"Activate mail support","text":"<ul> <li>Configure mail server in Settings -&gt; General -&gt; Mail</li> <li>Configure Nextflow to use Cloudgenes mail settings by add the following to the global configuration (Settings -&gt; General -&gt; Nextflow) or adapt/create files <code>config/nextflow.confing</code> (see Nextflow Documention for all available mail settings)</li> </ul> <pre><code>mail {\n    smtp.host = \"${CLOUDGENE_SMTP_HOST}\"\n    smtp.port = \"${CLOUDGENE_SMTP_PORT}\"\n    smtp.user = \"${CLOUDGENE_SMTP_USER}\"\n    smtp.password = \"${CLOUDGENE_SMTP_PASSWORD}\"\n    smtp.auth = true\n    smtp.starttls.enable = true\n    smtp.ssl.protocols = 'TLSv1.2'\n}\n</code></pre> <ul> <li>Add <code>params.config.send_mail = true</code> to the application specific configuration to activate mail notifications in the imputationserver2 pipeline</li> </ul>"},{"location":"#adapt-default-parameters","title":"Adapt default parameters","text":"<p>Parameters can be changed in the `nextflow.config`` file of the application. Example:</p> <pre><code>params.chunk_size = 500000\nparams.imputation.window = 100000\n</code></pre>"},{"location":"#development","title":"Development","text":""},{"location":"#build-docker-image-locally","title":"Build docker image locally","text":"<pre><code>docker build -t genepi/imputation-docker:latest .\n</code></pre>"},{"location":"#run-testcases","title":"Run testcases","text":"<pre><code>nf-test test\n</code></pre>"},{"location":"#license","title":"License","text":"<p>imputationserver2 is MIT Licensed and was developed at the Institute of Genetic Epidemiology, Medical University of Innsbruck, Austria.</p>"},{"location":"#contact","title":"Contact","text":"<ul> <li>Sebastian Sch\u00f6nherr</li> <li>Lukas Forer</li> </ul>"},{"location":"contact/","title":"Contact","text":"<p>The complete Imputation Server 2 source code is available on GitHub and has been developed by Lukas Forer and Sebastian Sch\u00f6nherr from the Institute of Genetic Epidemiology, Medical University of Innsbruck. </p>"}]}